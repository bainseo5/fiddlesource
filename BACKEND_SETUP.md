# FiddleSource - Traditional Music Archive

A full-stack web application for browsing, archiving, and analyzing traditional Irish and North American fiddle music from the O'Connor's Bar session (1962).

## Architecture

- **Frontend:** React + TypeScript + Vite
- **Backend:** Node.js + Express
- **Data Storage:** JSON files (for simplicity and local development)
- **AI Integration:** Google Gemini API for tune insights and musicology chatbot
- **Audio Storage:** IndexedDB (browser) for archived recordings

## Prerequisite Setup

### Backend
Make sure you have Node.js installed. The backend server runs on **port 3001**.

#### 1. Start the Backend Server

```bash
cd backend
npm install
node server.js
```

The server will:
- Load 56 pre-cataloged tunes from the Doolin session
- Create a RESTful API for tune data, user management, playlists, and playback history
- Listen on `http://localhost:3001`

### Frontend
#### 2. Start the Frontend Development Server

In the root project directory:

```bash
npm install
npm run dev
```

The frontend will:
- Start on `http://localhost:5173` (or another port if 5173 is occupied)
- Connect to the backend API at `http://localhost:3001/api`

## Features

### Core
- âœ… Browse 56 pre-cut traditional tunes from the Doolin session
- âœ… Search by title, artist, region, musical key, or genre
- âœ… Play audio directly in the browser
- âœ… AI-powered ethnomusicological insights via Gemini
- âœ… Interactive musicology chatbot

### Audio Management
- âœ… Archive tunes locally to IndexedDB for offline access
- âœ… Download tunes as MP3 or WAV
- âœ… Import custom audio files from your device or URLs
- âœ… Extract specific segments as separate audio files

### User Features (Backend Ready)
- ðŸ”§ User creation (currently auto-generates guest users)
- ðŸ”§ Playlist creation and management
- ðŸ”§ Playback history tracking
- ðŸ”§ Top-played tunes analytics

## API Endpoints

### Tunes
- `GET /api/tunes` - Get all tunes
- `GET /api/tunes/:id` - Get a single tune
- `GET /api/search?query=...&region=...&key=...&genre=...` - Search tunes

### Users
- `POST /api/users` - Create a user
- `GET /api/users/:id` - Get user details

### Playlists
- `POST /api/playlists` - Create a playlist
- `GET /api/users/:userId/playlists` - Get user's playlists
- `GET /api/playlists/:id` - Get a playlist with tunes
- `POST /api/playlists/:playlistId/tunes/:tuneId` - Add tune to playlist
- `DELETE /api/playlists/:playlistId/tunes/:tuneId` - Remove tune from playlist

### Playback History
- `POST /api/playback-history` - Log a playback event
- `GET /api/users/:userId/playback-history?limit=50` - Get playback history
- `GET /api/users/:userId/top-played?limit=10` - Get top-played tunes

## Environment Variables

### Frontend (.env.local)
```
VITE_API_BASE_URL=http://localhost:3001
GEMINI_API_KEY=your_gemini_api_key_here
```

### Backend
No environment variables required for local development. Data is stored in `backend/data/tunes.json`, `backend/data/users.json`, etc.

## File Structure

```
.
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ server.js           # Express API server
â”‚   â”œâ”€â”€ seed.js             # Seed script (populates data/tunes.json)
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ tunes.json      # Pre-cut tune metadata
â”‚   â”‚   â”œâ”€â”€ users.json      # User accounts
â”‚   â”‚   â”œâ”€â”€ playlists.json  # User playlists
â”‚   â”‚   â””â”€â”€ playback_history.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx             # Main React component
â”‚   â”œâ”€â”€ api.ts              # API client
â”‚   â”œâ”€â”€ geminiService.ts    # Gemini AI integration
â”‚   â”œâ”€â”€ db.ts               # IndexedDB functions
â”‚   â”œâ”€â”€ audioUtils.ts       # Audio processing
â”‚   â”œâ”€â”€ components/         # React components
â”‚   â”œâ”€â”€ data/tunes.ts       # Legacy: Local tune data
â”‚   â””â”€â”€ ...
â”œâ”€â”€ public/
â”‚   â””â”€â”€ doolin_cuts/        # Pre-cut MP3 files (not included in repo)
â””â”€â”€ ...
```

## Getting Audio Files

The `public/doolin_cuts/` directory should contain the 56 pre-cut MP3 files. These are generated by the `cut.py` Python script in the `scripts/` folder:

```bash
cd scripts
python cut.py
# This generates MP3 files in output/ that should be moved or symlinked to public/doolin_cuts/
```

## Future Development

### Planned Features
- User authentication with JWT or OAuth
- Persistent user accounts (database migration from JSON)
- Playlist collaboration
- Advanced audio features (time-stretching, pitch-shifting)
- Export playlists as audio compilation
- Mobile app version
- Integration with music theory tools (notation generation)

### Database Migration
To migrate from JSON to PostgreSQL or MongoDB:
1. Create a migration script in `backend/migrations/`
2. Update API endpoints to query the database instead of JSON files
3. Update frontend environment variables

## Troubleshooting

### Backend won't start
```
Error: listen EADDRINUSE :::3001
```
â†’ Port 3001 is already in use. Change PORT in `backend/server.js` and update frontend API URL.

### Frontend can't connect to backend
â†’ Ensure backend is running on `http://localhost:3001` and CORS is enabled (it is).

### Tunes not loading
â†’ Check that `seed.js` was run successfully and `backend/data/tunes.json` exists.

### Audio files not found
â†’ Ensure MP3 files are in `public/doolin_cuts/` with correct naming from the seed data.

## Contributing

Contributions welcome! Please:
1. Fork the repository
2. Create a feature branch
3. Submit a pull request

## License

This project uses recordings from the O'Connor's Bar session (Doolin, 1962) recorded by Joe Vaughan. All rights to the original recordings remain with the copyright holders. This software is provided for educational and archival purposes.

## Credits

- **Original Recordings:** O'Connor's Bar, Doolin (1962)
- **Featured Artists:** Micho Russell, Peadar O'Loughlin, Willie Shannon, Paddy Killourhy, Willie Clancy, Joe Cuneen
- **Recording:** Joe Vaughan
- **Project:** FiddleSource - Traditional Music Archive

---

**Enjoy exploring traditional music!** ðŸŽµ
